<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Mixed models - Interpretation and visualization</title>

<script src="site_libs/header-attrs-2.5/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0/anchor-sections.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">IDR4000 Course notes</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Lessons
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lesson_1_installation.html">Installing and starting up R and RStudio</a>
    </li>
    <li>
      <a href="lesson_2_markdown.html">Creating a report using rmarkdown</a>
    </li>
    <li>
      <a href="lesson_3_structure.html">Structuring an analysis</a>
    </li>
    <li>
      <a href="lesson_4_scripts.html">R scripts and R markdown files</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="lesson_5_import_data.html">Import data</a>
    </li>
    <li>
      <a href="lesson_6_make_summaries.html">Make summaries of data</a>
    </li>
    <li>
      <a href="lesson_7_ggplot2.html">Making figures</a>
    </li>
    <li>
      <a href="lesson_8_making_tables.html">Making tables</a>
    </li>
    <li>
      <a href="lesson_9_git.html">Version control and GitHub</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="lesson_10_inference.html">Introduction to statistical inference</a>
    </li>
    <li>
      <a href="lesson_11_inference2.html">Statistical inference, p-values and confidence intervals</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="lesson_12_regressionModels.html">Regression models part 1</a>
    </li>
    <li>
      <a href="lesson_13_regressionModels2.html">Regression models part 2: Lactate threshold analysis</a>
    </li>
    <li>
      <a href="lesson_14_correlation.html">Regression models and correlations</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="lesson_15_analyzingTrials.html">Analyzing pre- to post-experiments</a>
    </li>
    <li>
      <a href="lesson_16_mixed_models.html">Analyzing trials with mixed-model</a>
    </li>
    <li>
      <a href="lesson_17_mixed_models2.html">More on mixed models (visualizing models)</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="ex1_1_intro.html">Basic R</a>
    </li>
    <li>
      <a href="ex1_2_import.html">Importing data</a>
    </li>
    <li>
      <a href="ex1_3_summarise.html">Summarise data</a>
    </li>
    <li>
      <a href="ex1_4_figures.html">Making figures</a>
    </li>
    <li>
      <a href="ex1_5_group_exercise.html">Group exercises</a>
    </li>
    <li>
      <a href="ex2_1_inference.html">Inference</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Assignments
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="assignment_1_descriptives.html">Descriptive data</a>
    </li>
    <li>
      <a href="feedback_1.html">Feedback assignment 1</a>
    </li>
    <li>
      <a href="assignment_2_inference.html">Inference</a>
    </li>
    <li>
      <a href="feedback_2.html">Feedback assignment 2</a>
    </li>
    <li>
      <a href="assignment_3_regression.html">Regression models</a>
    </li>
    <li>
      <a href="feedback_3.html">Feedback assignment 3</a>
    </li>
    <li>
      <a href="assignment_4_repeated.html">Repeated measures studies</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="faq.html">
    <span class="fa fa-question fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Mixed models - Interpretation and visualization</h1>

</div>


<style>
p.caption {
  font-size: 0.8em;
}
</style>
<script language="javascript"> 
    function toggle(num) {
      var ele = document.getElementById("toggleText" + num);
      var text = document.getElementById("displayText" + num);
      if(ele.style.display == "block") {
        ele.style.display = "none";
        text.innerHTML = "show";
      }
      else {
        ele.style.display = "block";
        text.innerHTML = "hide";
      }
   } 
  </script>
<div id="a-multiple-time-point-study" class="section level1">
<h1>A multiple time-point study</h1>
<p>In previous lessons where we used ANCOVA models to account for the baseline we were able to get away with a simple linear regression model. This because we modeled the change- or post-scores, we did not get any correlated errors (not multiple data points from each participant). The <code>ten_vs_thirty.xlsx</code> data set contains three time-points per participant, it is thus not straight forward to put all this data in one model as the data are correlated. As we saw in a previous lesson, not accounting for the correlation in repeated measures studies could affect statistical power.</p>
<p>In this lesson we will model strength data with a linear mixed model (LMM). We will interpret the output and make plots of the model estimates.</p>
<div id="an-hypothetical-example" class="section level2">
<h2>An hypothetical example</h2>
<p>A theoretical outcome of the study in this example could look something like in Figure 1 below.</p>
<p><img src="lesson_17_mixed_models2_files/figure-html/unnamed-chunk-1-1.png" width="1800" style="display: block; margin: auto;" /></p>
<p>The 30RM group starts off at approximately the same level as the 10RM group. After the first period (from Pre to Mid) the 10RM group potentially increases strength more than the 30RM group, the difference could be maintained to the Post time-point.</p>
<p>Instead of modeling the effect of the baseline on the outcome we could control for it by adjusting the average levels at Mid and Post by removing the differences seen at baseline. This is the basic approach when analyzing repeated measures deigns with mixed models. Before we get to this step we will build the model from the bottom up.</p>
<p>In a first model we do not include any “fixed effects.” We only estimate the mean of the whole data set, the very basic model formulation could look some thing like:</p>
<p><span class="math display">\[y = \beta_0\]</span> In R, we would write this model formula as</p>
<pre class="r"><code>strength ~ 1</code></pre>
<p>given that the dependent variable (y) is a variable we call strength. The number 1 indicates that we only include an intercept in the model. Thus, the data are explained with an intercept only. In the figure below, this model is represented by the black cross.</p>
<p>We could add information about the time-points to the model, still leaving out information regarding grouping. This model formulation could look something like this:</p>
<p><span class="math display">\[y = \beta_0 + \beta_{Mid} + \beta_{Post}\]</span> Where <span class="math inline">\(\beta_{Mid}\)</span> is a dummy variable assigned number 1 when time = “mid” otherwise 0, and <span class="math inline">\(\beta_{Post}\)</span> is a dummy variable assigned 1 when time = “post” otherwise 0. This model, given our hypothetical data in this example could look like the black line in the plot below.</p>
<p>In R, we would write this model formula as</p>
<pre class="r"><code>strength ~ time</code></pre>
<p>R automatically converts the time variable to two dummy variables as described in the formula above.</p>
<div class="figure" style="text-align: center">
<img src="lesson_17_mixed_models2_files/figure-html/unnamed-chunk-4-1.png" alt="Figure 2. Hypothetical model of a study strength development in two groups. The black cross represents a model of the data only modelling the mean, the black line represents a model modelling the average change over time in the two groups. Hypothetical values per group and time are represented in colored lines" width="1800" />
<p class="caption">
Figure 2. Hypothetical model of a study strength development in two groups. The black cross represents a model of the data only modelling the mean, the black line represents a model modelling the average change over time in the two groups. Hypothetical values per group and time are represented in colored lines
</p>
</div>
<p>To account for the difference between groups at baseline we could add an estimate of the effect of baseline differences. In a simplified description this could look like:</p>
<p><span class="math display">\[y = \beta_0 + \beta_{Group} + \beta_{Mid} + \beta_{Post}\]</span> Where the additional <span class="math inline">\(\beta_{Group}\)</span> is a dummy variable assigning 1 to all observations in the 30RM group and 0 otherwise. In R we extend the model formulation simply by adding group:</p>
<p>In R, we would write this model formula as</p>
<pre class="r"><code>strength ~ group + time </code></pre>
<p>Estimates from the new model will have one “line” per group representing the average difference between groups at baseline but not accounting for differences in changes over time per group. The two black dashed lines in Figure 3 represents this model.</p>
<div class="figure" style="text-align: center">
<img src="lesson_17_mixed_models2_files/figure-html/unnamed-chunk-6-1.png" alt="Figure 3. Hypothetical model of a study strength development in two groups. The black cross represents a model of the data only modelling the mean, the solid black line represents a model modelling the average change over time in the two groups. The dashed black lines represents the average change over time with baseline difference between groups at baseline accounted for. Hypothetical values per group and time are represented in colored lines" width="1800" />
<p class="caption">
Figure 3. Hypothetical model of a study strength development in two groups. The black cross represents a model of the data only modelling the mean, the solid black line represents a model modelling the average change over time in the two groups. The dashed black lines represents the average change over time with baseline difference between groups at baseline accounted for. Hypothetical values per group and time are represented in colored lines
</p>
</div>
<p>Notice that the addition of the group term creates two parallel lines representing each group. To fully capture the average changes per group we need to let the model account for different changes per time in each group. We do this by adding an “interaction term.” The interaction term allows for each group to have different values at “Mid” and “Post.”</p>
<p>A simplified model formulation could look like this:</p>
<p><span class="math display">\[y = \beta_0 + \beta_{Group} + \beta_{Mid} + \beta_{Post} + \beta_{Mid:Group} + \beta_{Post:Group}\]</span></p>
<p>In R, we would write this model formula as</p>
<pre class="r"><code>strength ~ group + time + group:time</code></pre>
<p>We may also simplify the above formula like this:</p>
<pre class="r"><code>strength ~ group * time </code></pre>
<p>The output from this model given our hypothetical data could look like in table 1.</p>
<table>
<caption>
Table 1. Regression coefficients from an hypothetical data set.
</caption>
<thead>
<tr>
<th style="text-align:left;">
Coefficient
</th>
<th style="text-align:right;">
Estimate
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
0.45
</td>
</tr>
<tr>
<td style="text-align:left;">
TimeMid
</td>
<td style="text-align:right;">
0.15
</td>
</tr>
<tr>
<td style="text-align:left;">
TimePost
</td>
<td style="text-align:right;">
0.20
</td>
</tr>
<tr>
<td style="text-align:left;">
Group10RM
</td>
<td style="text-align:right;">
0.05
</td>
</tr>
<tr>
<td style="text-align:left;">
TimeMid:Group10RM
</td>
<td style="text-align:right;">
0.15
</td>
</tr>
<tr>
<td style="text-align:left;">
TimePost:Group10RM
</td>
<td style="text-align:right;">
0.20
</td>
</tr>
</tbody>
</table>
<p>The 30RM group is the reference group so the intercept estimate is the mean in this group at the Pre time point. The 30RM group increases by 0.15 units from Pre to Mid and 0.20 units from Pre to Post. At Pre, the 10RM group is 0.05 units above the 30RM group. Compared to the change seen in the 30RM group, the 10RM group increases an additional 0.15 points Pre to Mid and an additional 0.20 units from Pre to Post.</p>
<p>To calculate the average in the 30RM group at Mid we can combine estimates from the regression table (above) according to our model formula. Keeping only the terms needed</p>
<p><span class="math display">\[y = \beta_0 + \beta_{Mid} \]</span> <span class="math display">\[y = 0.45 + 0.15\]</span></p>
<p><span class="math display">\[y = 0.6\]</span> The same principles apply if we want to know the estimated mean in the 10RM group at Post, keeping the relevant terms:</p>
<p><span class="math display">\[y = \beta_0 + \beta_{Group}  + \beta_{Post} + \beta_{Post:Group}\]</span> <span class="math display">\[y=0.45 + 0.05 + 0.2 + 0.2\]</span> <span class="math display">\[y=0.9\]</span> By adding up the terms in a linear fashion (hence linear regression) we can calculate the estimated averages from both groups.</p>
<p>The final model allows for different changes over time per group. And different regression estimates will reflect these patterns (Figure 4).</p>
<div class="figure" style="text-align: center">
<img src="lesson_17_mixed_models2_files/figure-html/unnamed-chunk-10-1.png" alt="Figure 4. Hypothetical model of a study on strength development in two groups. The dashed colored lines represents the average change over time per group with baseline difference between groups at baseline accounted for. Regression terms are printed to represent a full interaction model describing the data." width="1800" />
<p class="caption">
Figure 4. Hypothetical model of a study on strength development in two groups. The dashed colored lines represents the average change over time per group with baseline difference between groups at baseline accounted for. Regression terms are printed to represent a full interaction model describing the data.
</p>
</div>
</div>
<div id="inference-from-a-repeated-measures-study" class="section level2">
<h2>Inference from a repeated measures study</h2>
<p>In the scenario described above the most meaningful comparison between groups are the differences in change over time between groups. This is because our design lets us do this comparison. A comparison that is much more uncertain in a study like this is the within-group changes over time. This is because we do not have a control condition for comparison. Imagine that in our example above, the two groups are both training, comparing the two groups means that we are comparing two different training protocols. We might be tempted to say that the average increase in strength is due to the training, however, strictly speaking this problematic as we do not have a group of randomly assigned individuals who have performed all tests but not performed the training. The effect we see on strength on average could be an effect of learning the strength test. We can not isolate the training effect from other effects when we do not have a control group!</p>
<p>In comparing the two training protocols we do have a control as we are comparing the two groups to each other.</p>
<div id="evaluating-regression-coefficients" class="section level3">
<h3>Evaluating regression coefficients</h3>
<p>In the hypothetical example above the two coefficients that are of interest are the two interaction estimates. Let’s evaluate their confidence intervals. Table 2 gives hypothetical 95% confidence intervals on the interaction terms.</p>
<table>
<caption>
Table 2. Interaction coefficients from an hypothetical data set.
</caption>
<thead>
<tr>
<th style="text-align:left;">
Coefficient
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:left;">
95% CI
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
TimeMid:Group10RM
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:left;">
-0.05, 0.35
</td>
</tr>
<tr>
<td style="text-align:left;">
TimePost:Group10RM
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:left;">
0.05, 0.35
</td>
</tr>
</tbody>
</table>
<p>The interpretation could be that the 10RM group increases strength more than the 30RM group, the 95% CI at time-point Mid indicate that no difference between groups are within the probable values (95% CI) indicating true effect might here might be no difference. At time-point post, our 95% CI indicates that we do not have the zore-effect among our probable values.</p>
</div>
</div>
</div>
<div id="using-real-data" class="section level1">
<h1>Using real data</h1>
<p>We start by loading the data and packages. Notice that we are loading the <code>lme4</code> package that we will use to fit mixed models. We also load the <code>emmeans</code> package that we will use to get estimates from each model. For this example we will work with leg-press data.</p>
<pre class="r"><code>library(tidyverse); library(readxl); library(lme4); library(emmeans)

dat &lt;- read_excel(&quot;./data/ten_vs_thirty.xlsx&quot;, na = &quot;NA&quot;) %&gt;%
  filter(exercise == &quot;legpress&quot;) %&gt;%
    # Fix the time factor in the right order for plotting 
  # and fix the grouping so that the 30RM group comes first (comparing to 30RM)
  mutate(timepoint = factor(timepoint, levels = c(&quot;pre&quot;, &quot;mid&quot;, &quot;post&quot;)), 
         group = factor(group,  levels = c(&quot;RM30&quot;, &quot;RM10&quot;)))</code></pre>
<div id="data-exploration" class="section level2">
<h2>Data exploration</h2>
<p>It is alway a good idea to plot the data to get a sense of what you will find in any subsequent models. Let’s build a plot that shows changes in strength for each participant in each group.</p>
<pre class="r"><code>dat %&gt;%
  # build the plot, each participant (subject) will get a line, group = subject
  # will take care of this. Each group will get it&#39;s own color, color = group
  # will take care of that.
  ggplot(aes(timepoint, load, group = subject, color = group)) + geom_line() +
  theme_minimal()</code></pre>
<pre><code>## Warning: Removed 3 row(s) containing missing values (geom_path).</code></pre>
<p><img src="lesson_17_mixed_models2_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>We can see that most participants increase their strength, it is not clear if one group increases more than the other. We can add boxplots on top to get an idea.</p>
<pre class="r"><code>dat %&gt;%
  # build the plot, each participant (subject) will get a line, group = subject
  # will take care of this. Each group will get it&#39;s own color, color = group
  # will take care of that.
  ggplot(aes(timepoint, load, group = subject, color = group)) + 
  geom_line() +
  # remove grouping from boxplots to plot group averages
  geom_boxplot(aes(group = NULL), width = 0.5) +
  theme_minimal()</code></pre>
<pre><code>## Warning: Removed 3 rows containing non-finite values (stat_boxplot).</code></pre>
<pre><code>## Warning: Removed 3 row(s) containing missing values (geom_path).</code></pre>
<p><img src="lesson_17_mixed_models2_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>The graphics suggests a small effect in favor of 10RM at post. Let’s fit the model.</p>
</div>
<div id="fit-a-mixed-model" class="section level2">
<h2>Fit a mixed model</h2>
<p>The model will be fairly simple. We want to compare the two groups an model any differences in change over time. This means that the model must contain the time and group variable as well as their interaction giving each group a chance to “vary on their own.” The beauty of the mixed model is that we can account for repeated data just by using the subject indicator a random efect. The data in this example allows for the inclusion of a random intercept, meaning that each particiapnt will be compared from their own strating point (intercept).</p>
<pre class="r"><code># The lmer function from the lme4 package.
m1 &lt;- lmer(load ~ timepoint * group + (1|subject), data = dat)</code></pre>
<p>Before doing anything with this model we will have to check if our assumptions are met. Let’s do a residuals plot.</p>
<pre class="r"><code>plot(m1)</code></pre>
<p><img src="lesson_17_mixed_models2_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>The residual plot indicates that there are not obvious patterns in the data, the residual variation is similar over the range of fitted values. The model is OK.</p>
<p>We can now check if the model behaves similar to what we expect when looking at the raw data. We will use the <code>emmeans</code> package to get model estimates, estimated averages at each time-point within each group. The data may be plotted.</p>
<pre class="r"><code># Using the model (m1) we can specify the emmeans function to get model estimates

# The specs argument specifies what means to calculate from the model.
# The code below takes care of the full model (including interactions).
est &lt;- emmeans(m1, specs = ~ timepoint|group)</code></pre>
<p>To use an object created with <code>emmeans</code> in plotting we need to convert it to a data frame. It is then straight forward to plot.</p>
<pre class="r"><code>est %&gt;%
  data.frame() %&gt;%
  mutate(timepoint = factor(timepoint, levels = c(&quot;pre&quot;, &quot;mid&quot;, &quot;post&quot;))) %&gt;%

  ggplot(aes(timepoint, emmean, group = group, color = group)) + geom_line() +
  theme_minimal()</code></pre>
<p><img src="lesson_17_mixed_models2_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>In the code creating the plot above I specified the <code>group</code> and <code>color</code> arguments in ggplot to equal group in our data set. This means that lines will be drawn with different colors connecting data from each group.</p>
<p>We can see in the figure that the 10RM group on average seems to increase more from pre to post than the 30RM group.</p>
<p>We could add error-bars to this plot that represents the 95% confidence interval of each estimate. I will tweak the plot further to avoid overplotting and add points to indicate where estimates have been made.</p>
<pre class="r"><code>est %&gt;%
  data.frame() %&gt;%
  mutate(timepoint = factor(timepoint, levels = c(&quot;pre&quot;, &quot;mid&quot;, &quot;post&quot;))) %&gt;%

  ggplot(aes(timepoint, emmean, group = group, color = group)) + 
  
  geom_errorbar(aes(ymin = lower.CL, ymax = upper.CL), 
                position = position_dodge(width = 0.2), 
                width = 0.1) +
  geom_line(position = position_dodge(width = 0.2)) +
  geom_point(position = position_dodge(width = 0.2)) +
  
  theme_minimal()</code></pre>
<p><img src="lesson_17_mixed_models2_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>The <code>position = position_dodge(width = 0.2)</code> argument inside <code>geom_errorbar()</code>, <code>geom_point()</code> and <code>geom_line()</code> moves the points, lines and error-bars away from each other based on the grouping (<code>group = group</code> in <code>aes()</code>). The <code>width</code> argument in <code>geom_errobar</code> sets the width of the error-bars. There is nothing magical with these numbers, I just think it looks nice.</p>
<p>The confidence bounds around each measurement does not really answer our question of differences between groups in change over time. These are just the 95% CI around the estimated means for each group at each time-point. Some would say that they are so non-informative that they should not be presented. I think it is good practice to plot what the model estimates, this gives you an opportunity to assess if the model actually captures the data! We get standard errors and 95% confidence intervals from model estimates and the 95% CI are preferred for plotting.</p>
</div>
<div id="do-the-model-capture-the-data" class="section level2">
<h2>Do the model capture the data?</h2>
<p>Lets combine raw data and model estimates in the same plot! We can combine several data sources in ggplots like described in the code below. We will simply extend the last figure and include raw data. By including a separate data argument in a <code>geom_</code> we can overlay these data on the same plot.</p>
<pre class="r"><code>est %&gt;%
  data.frame() %&gt;%
  mutate(timepoint = factor(timepoint, levels = c(&quot;pre&quot;, &quot;mid&quot;, &quot;post&quot;))) %&gt;%

  ggplot(aes(timepoint, emmean, group = group, color = group) ) + 
  
  # Adds raw data
  geom_line(data = dat, aes(timepoint, load, group = subject, color = group), 
            # Add transparency to individual lines
            alpha = 0.4) +
  
  geom_errorbar(aes(ymin = lower.CL, ymax = upper.CL), 
                position = position_dodge(width = 0.2), 
                width = 0.1) +
  geom_line(position = position_dodge(width = 0.2)) +
  geom_point(position = position_dodge(width = 0.2)) +
  theme_minimal()</code></pre>
<pre><code>## Warning: Removed 3 row(s) containing missing values (geom_path).</code></pre>
<p><img src="lesson_17_mixed_models2_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>Using <code>alpha = 0.4</code> we make the lines representing individual data a bit more transparent. Nice! We now have a plot showing the raw data and the model estimates. They seem to capture the data pretty well (we have also seen the residual plot indicating this).</p>
</div>
<div id="inference-about-the-effect-of-interest" class="section level2">
<h2>Inference about the effect of interest</h2>
<p>We have still not answered our question regarding the effect of training with different intensity. To do this we will need to get the estimates of the interaction coefficients from the model. To keep up with our very visual way of looking at the data we could plot the confidence intervals from these effects. Using the <code>confint()</code> function we will get the 95% CI from each model coefficient.</p>
<p>We need to build a data frame out of this information and the coefficients from the <code>summary()</code> output.</p>
<pre class="r"><code># Save the confidence intervals
conf_intervals &lt;- confint(m1)</code></pre>
<pre><code>## Computing profile confidence intervals ...</code></pre>
<pre class="r"><code># Save the regression coefficients
coefs &lt;- summary(m1)$coef

# Using cbind (column bind) to combine the two data frames
coef_summary &lt;- cbind(coefs, data.frame(conf_intervals)[3:8, ]) 

# Print the table in a pretty format

coef_summary %&gt;%
  kable()</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Std. Error
</th>
<th style="text-align:right;">
t value
</th>
<th style="text-align:right;">
X2.5..
</th>
<th style="text-align:right;">
X97.5..
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
281.53846
</td>
<td style="text-align:right;">
20.120706
</td>
<td style="text-align:right;">
13.9924743
</td>
<td style="text-align:right;">
242.37410
</td>
<td style="text-align:right;">
320.70282
</td>
</tr>
<tr>
<td style="text-align:left;">
timepointmid
</td>
<td style="text-align:right;">
35.00000
</td>
<td style="text-align:right;">
8.968506
</td>
<td style="text-align:right;">
3.9025454
</td>
<td style="text-align:right;">
17.80241
</td>
<td style="text-align:right;">
52.19759
</td>
</tr>
<tr>
<td style="text-align:left;">
timepointpost
</td>
<td style="text-align:right;">
38.86796
</td>
<td style="text-align:right;">
9.550460
</td>
<td style="text-align:right;">
4.0697470
</td>
<td style="text-align:right;">
20.53927
</td>
<td style="text-align:right;">
57.16481
</td>
</tr>
<tr>
<td style="text-align:left;">
groupRM10
</td>
<td style="text-align:right;">
-7.60989
</td>
<td style="text-align:right;">
27.942231
</td>
<td style="text-align:right;">
-0.2723437
</td>
<td style="text-align:right;">
-61.99862
</td>
<td style="text-align:right;">
46.77884
</td>
</tr>
<tr>
<td style="text-align:left;">
timepointmid:groupRM10
</td>
<td style="text-align:right;">
11.07143
</td>
<td style="text-align:right;">
12.454834
</td>
<td style="text-align:right;">
0.8889262
</td>
<td style="text-align:right;">
-12.81138
</td>
<td style="text-align:right;">
34.95423
</td>
</tr>
<tr>
<td style="text-align:left;">
timepointpost:groupRM10
</td>
<td style="text-align:right;">
38.57427
</td>
<td style="text-align:right;">
13.043542
</td>
<td style="text-align:right;">
2.9573464
</td>
<td style="text-align:right;">
13.57176
</td>
<td style="text-align:right;">
63.59255
</td>
</tr>
</tbody>
</table>
<p><code>X2.5..</code> and <code>X97.5..</code> represents the lower and upper confidence interval for each estimate. The estimate that we are interested in are <code>timepoint:groupRM10</code>and <code>timepointpost:groupRM10</code>. We can now reduce the data frame and plot it to show estimated differences between groups at time-points “mid” and “post.”</p>
<p>We will make a plot mirroring the plot showing raw values and model estimates. We need all time-points to be represented but only “mid” and “post” to contain data.</p>
<pre class="r"><code>coef_summary %&gt;%
  mutate(coef = rownames(.)) %&gt;%
  # Filter only the interaction variables
  filter(coef %in% c(&quot;timepointmid:groupRM10&quot;, &quot;timepointpost:groupRM10&quot;)) %&gt;%
  # Make a &quot;timepoint&quot; variable to represent the &quot;dat&quot; data set.
  mutate(timepoint = gsub(&quot;timepoint&quot;, &quot;&quot;, coef), 
         timepoint = gsub(&quot;:groupRM10&quot;, &quot;&quot;, timepoint)) %&gt;%
  # Adds a row so that timepoint = &quot;pre&quot; is represented
  add_row(timepoint = &quot;pre&quot;, coef = &quot;pre&quot;) %&gt;%
  # Fix order of the time variable
  mutate(timepoint = factor(timepoint, levels = c(&quot;pre&quot;, &quot;mid&quot;, &quot;post&quot;))) %&gt;%
  
  # Create the plot
  ggplot(aes(timepoint, Estimate)) + 
  
  
  # Add a line indicating zero geom_hline (horizontal line)
  geom_hline(yintercept = 0, lty = 2) +
  
  geom_errorbar(aes(ymin = X2.5.., ymax = X97.5..), width = 0.1) +
  geom_point(shape = 24, size = 3, fill = &quot;white&quot;) +
  theme_minimal()</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p><img src="lesson_17_mixed_models2_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>The plot shows the differences between groups at time-points “mid” and “post” after accounting for baseline differences. This is the answer to our question regarding the differences between training intensity, 10RM seems to be superior!</p>
<p>We can combine the two plots. The package <code>cowplot</code> has functions to plot several ggplots into one single plot.</p>
<p>First we save each plot and the combine them using <code>plot_grid</code>. I will do some modifications to make the plot a bit nicer.</p>
<pre class="r"><code>## Figure 1: Estimated means and raw data

figA &lt;- est %&gt;%
  data.frame() %&gt;%
  mutate(timepoint = factor(timepoint, levels = c(&quot;pre&quot;, &quot;mid&quot;, &quot;post&quot;))) %&gt;%

  ggplot(aes(timepoint, emmean, group = group, color = group) ) + 
  
  # Adds raw data
  geom_line(data = dat, aes(timepoint, load, group = subject, color = group), 
            # Add transparency to individual lines
            alpha = 0.4) +
  
  geom_errorbar(aes(ymin = lower.CL, ymax = upper.CL), 
                position = position_dodge(width = 0.2), 
                width = 0.1) +
  geom_line(position = position_dodge(width = 0.2)) +
  geom_point(position = position_dodge(width = 0.2)) +
  theme_minimal() +
  
  # Changing axis titles and title in the legend
  labs(y = &quot;Legpress 1RM load (kg)&quot;, 
       color = &quot;Intensity&quot;) + 
  
  # Removing text and indicators on the x-axis as these can be represented in the 
  # other plot
  theme(axis.text.x = element_blank(), 
        axis.title.x = element_blank())
  
# Figure B: Differences between groups (interaction terms with 95% CI)

figB &lt;- coef_summary %&gt;%
  mutate(coef = rownames(.)) %&gt;%
  # Filter only the interaction variables
  filter(coef %in% c(&quot;timepointmid:groupRM10&quot;, &quot;timepointpost:groupRM10&quot;)) %&gt;%
  # Make a &quot;timepoint&quot; variable to represent the &quot;dat&quot; data set.
  mutate(timepoint = gsub(&quot;timepoint&quot;, &quot;&quot;, coef), 
         timepoint = gsub(&quot;:groupRM10&quot;, &quot;&quot;, timepoint)) %&gt;%
  # Adds a row so that timepoint = &quot;pre&quot; is represented
  add_row(timepoint = &quot;pre&quot;, coef = &quot;pre&quot;) %&gt;%
  # Fix order of the time variable
  mutate(timepoint = factor(timepoint, levels = c(&quot;pre&quot;, &quot;mid&quot;, &quot;post&quot;))) %&gt;%
  
  # Create the plot
  ggplot(aes(timepoint, Estimate)) + 
  
  
  # Add a line indicating zero geom_hline (horizontal line)
  geom_hline(yintercept = 0, lty = 2) +
  
  geom_errorbar(aes(ymin = X2.5.., ymax = X97.5..), width = 0.1) +
  geom_point(shape = 24, size = 3, fill = &quot;white&quot;) +
  theme_minimal() + 
  
    # Changing axis titles and title in the legend
  labs(y = &quot;Average group differences\n(kg, 95% CI)&quot;, 
       color = &quot;Intensity&quot;) 
  
# Using cowplot to plot both figures in 1
library(cowplot)

# Plot grid using figA and figB
plot_grid(figA, figB, ncol = 1, 
          # Align vertically so that the x axis matches
          align = &quot;v&quot;, 
          # Set alignment so that axis align both on the left (l) and right (r)
          # axis
          axis = &quot;lr&quot;)</code></pre>
<pre><code>## Warning: Removed 3 row(s) containing missing values (geom_path).</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p><img src="lesson_17_mixed_models2_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<pre class="r"><code># Learn more about aligning:
# https://wilkelab.org/cowplot/articles/aligning_plots.html</code></pre>
<p>Success! We no have a two part figure showing model estimates and estimated mean differences between training conditions.</p>
</div>
<div id="more-about-the-model-summary" class="section level2">
<h2>More about the model summary</h2>
<p>Using <code>summary(m1)</code> we can get more information about the model we have fitted.</p>
<pre class="r"><code>summary(m1)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: load ~ timepoint * group + (1 | subject)
##    Data: dat
## 
## REML criterion at convergence: 752.7
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -1.77740 -0.40616 -0.04183  0.32323  2.07515 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  subject  (Intercept) 4740.1   68.85   
##  Residual              522.8   22.87   
## Number of obs: 78, groups:  subject, 27
## 
## Fixed effects:
##                         Estimate Std. Error t value
## (Intercept)              281.538     20.121  13.992
## timepointmid              35.000      8.969   3.903
## timepointpost             38.868      9.550   4.070
## groupRM10                 -7.610     27.942  -0.272
## timepointmid:groupRM10    11.071     12.455   0.889
## timepointpost:groupRM10   38.574     13.044   2.957
## 
## Correlation of Fixed Effects:
##             (Intr) tmpntm tmpntp grRM10 tmpntm:RM10
## timepointmd -0.223                                 
## timepontpst -0.209  0.470                          
## groupRM10   -0.720  0.160  0.151                   
## tmpntm:RM10  0.160 -0.720 -0.338 -0.223            
## tmpntp:RM10  0.153 -0.344 -0.732 -0.213  0.477</code></pre>
<p>Let’s first examine the random effects. In this model they are represented by a random intercept meaning that each participant has their own intercept in the model. The <code>Std.Dev.</code> (or standard deviation) in the random effects table indicates the mean variation between participants intercept. They vary at average 68.85 kg from the mean of each group.</p>
<p>The Residual indicates the variation that is not accounted for in the model by either random nor fixed effects.</p>
<p>The fixed effects are the model estimates of group and time effects in the model. This what we use to draw conclusions about their effects. Notice that we do not get any p-values. These have been left out of the <code>lmer</code> function.</p>
<p>Next table contains “approximate correlation of the estimator of the fixed effects”<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> (??). They are subject to more advanced discussions.</p>
<p>We have already seen that <code>confint</code> function can be used to get confidence intervals.</p>
<div id="i-neeeeed-p-values" class="section level4">
<h4>I neeeeed p-values</h4>
<p>There are several options (see <code>?lme4::pvalues</code>). A nice intuitive option is the removal of the term you are interested in and model comparison.</p>
<p>Let’s say that we are interested in the interaction between group and time. If this interaction is important, adding this information to the model would increase it’s ability to explain the data. We can actually test if this is true and in process get a p-value. Technically we will do a likelihood-ratio test. This tests compares two models and determines which one fits the data best.</p>
<pre class="r"><code># Fit a model not containing the interaction
m0 &lt;- lmer(load ~ timepoint + group + (1|subject), data = dat)


# Fit a model containing the interaction term
m1 &lt;- lmer(load ~ timepoint * group + (1|subject), data = dat)

# Compare the models using the anova function

anova(m0, m1)</code></pre>
<pre><code>## refitting model(s) with ML (instead of REML)</code></pre>
<pre><code>## Data: dat
## Models:
## m0: load ~ timepoint + group + (1 | subject)
## m1: load ~ timepoint * group + (1 | subject)
##    npar    AIC    BIC  logLik deviance Chisq Df Pr(&gt;Chisq)  
## m0    6 813.37 827.51 -400.68   801.37                      
## m1    8 808.33 827.18 -396.16   792.33 9.039  2    0.01089 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The output gives you the model formulation of each model being compared. The AIC is a measure of goodness of fit a lower value is better. The logLik is the value tested in a Chi<sup>2</sup> test and the p-value indicates if the models differ more than would be expected due to sampling error. Above, the comparison of models indicate that it is quite unlikely to see this difference if the models explained the data similarly. Thus, adding the interaction increases model <code>m1</code>s ability to explain the data, there is evidence for an interaction effect in the data.</p>
</div>
</div>
</div>
<div id="summary" class="section level1">
<h1>Summary</h1>
<p>Mixed models are very useful for fitting data containing correlated data. This e.g. is data where multiple data points are gathered from the same individuals such as in repeated measures designs. Mixed models can be extended in many ways to capture even more complicated data sets. Plotting the output of models are very useful to get a feeling about the model performace and what they actually tell you. Confidence intervals can be used for inference. If p-values are needed it is suggested that you use liklihood ratio tests to compare model.</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="https://stat.ethz.ch/pipermail/r-sig-mixed-models/2009q1/001941.html" class="uri">https://stat.ethz.ch/pipermail/r-sig-mixed-models/2009q1/001941.html</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
